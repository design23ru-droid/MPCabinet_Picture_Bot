# Wildberries Media Bot

Telegram –±–æ—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ –∏ –≤–∏–¥–µ–æ —Ç–æ–≤–∞—Ä–æ–≤ —Å Wildberries –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É –∏–ª–∏ —Å—Å—ã–ª–∫–µ.

**–í–µ—Ä—Å–∏—è:** 0.5.0 | **Test Coverage:** 82% | **Python:** 3.11+

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì∑ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ç–æ–≤–∞—Ä–æ–≤ (–¥–æ 10 —à—Ç –∑–∞ —Ä–∞–∑)
- üé• –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ —Ç–æ–≤–∞—Ä–æ–≤ (MP4 –∏ HLS —Ñ–æ—Ä–º–∞—Ç—ã —Å –∞–≤—Ç–æ–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π)
- üîó –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Ä—Ç–∏–∫—É–ª–æ–≤ –∏ —Å—Å—ã–ª–æ–∫ Wildberries
- ‚ö° –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- üìä –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–∏—Å–∫–∞ –≤–∏–¥–µ–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (0.3.0+)
- üíæ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ URLs (TTL 1 —á–∞—Å) (0.3.2+)
- üéØ –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞ (0.3.1+)
- üöÄ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Local Bot API (–ª–∏–º–∏—Ç 2GB –≤–º–µ—Å—Ç–æ 50MB)** (0.4.0+)
- üê≥ **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é (Docker + PostgreSQL)** (0.4.0+)
- üìä **–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** (0.5.0+)
- üîî **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö** (0.5.0+)
- üìà **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (00:00 –ú–°–ö)** (0.5.0+)
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
- üõ°Ô∏è –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ middleware
- üìù –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ 82% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ (113 —Ç–µ—Å—Ç–æ–≤)

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.11+**
- **aiogram 3** - async Telegram Bot framework (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Local Bot API)
- **aiohttp** - async HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ WB API
- **pydantic** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ settings
- **pytest** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å async –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- **Docker + Docker Compose** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –¥–µ–ø–ª–æ–π
- **PostgreSQL 16** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –±–æ—Ç–æ–≤
- **asyncpg** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
- **APScheduler** - –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –¥–ª—è –¥–∞–π–¥–∂–µ—Å—Ç–∞
- **ffmpeg** - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HLS –≤–∏–¥–µ–æ –≤ MP4

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone <your-repo-url>
cd MPCabinet_Picture_Bot
```

### 2. –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/Mac
python3 -m venv venv
source venv/bin/activate
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ffmpeg (–¥–ª—è HLS –≤–∏–¥–µ–æ)

ffmpeg —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ HLS –≤–∏–¥–µ–æ –≤ MP4:

```bash
# Windows
winget install ffmpeg

# Linux (Ubuntu/Debian)
sudo apt install ffmpeg

# macOS
brew install ffmpeg
```

### 5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
BOT_TOKEN=your_bot_token_from_botfather

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=INFO

# WB API
WB_API_TIMEOUT=10
WB_RATE_LIMIT_DELAY=0.2
MAX_RETRIES=3

# Local Bot API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Ñ–∞–π–ª–æ–≤ > 50MB)
# TELEGRAM_API_BASE_URL=http://telegram-bot-api:8081
# TELEGRAM_API_LOCAL=true

# PostgreSQL (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
DATABASE_URL=postgresql://user:pass@host:5432/db

# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
ANALYTICS_CHANNEL_ID=-1003238492068
ENABLE_ANALYTICS=true
```

### 6. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

1. –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º (—É–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ username –±–æ—Ç–∞)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ `.env`

## –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
python main.py
```

–í—ã —É–≤–∏–¥–∏—Ç–µ:

```
Bot starting...
Log level: INFO
WB API timeout: 10s
WB rate limit delay: 0.2s
Starting long polling...
```

–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω! –ù–∞–π–¥–∏—Ç–µ –µ–≥–æ –≤ Telegram –ø–æ username –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`.

### –î–µ–ø–ª–æ–π –Ω–∞ VPS (—Å Local Bot API)

–î–ª—è —Ñ–∞–π–ª–æ–≤ —Ä–∞–∑–º–µ—Ä–æ–º –¥–æ 2GB –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Local Telegram Bot API Server.

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: [docs/VDS.md](docs/VDS.md)

**–ö—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è:**

```bash
# –ù–∞ VPS: –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/<your-repo>/MPCabinet_Picture_Bot.git
cd /opt/telegram-ecosystem

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker Compose
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs -f mpcabinet-picture-bot
```

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Local Bot API, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω `TELEGRAM_API_BASE_URL` –≤ `.env`.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –∞—Ä—Ç–∏–∫—É–ª –∏–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–≤–∞—Ä:
   - `12345678`
   - `https://www.wildberries.ru/catalog/12345678/detail.aspx`

2. –í—ã–±–µ—Ä–∏—Ç–µ —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å:
   - üì∑ –§–æ—Ç–æ
   - üé• –í–∏–¥–µ–æ
   - üì∑ + üé• –í—Å—ë

3. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∞–π–ª—ã!

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
MPCabinet_Picture_Bot/
‚îÇ
‚îú‚îÄ‚îÄ main.py                      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ settings.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic
‚îÇ
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py            # /start, /help
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ article.py          # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Ä—Ç–∏–∫—É–ª–æ–≤/—Å—Å—ã–ª–æ–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callbacks.py        # –û–±—Ä–∞–±–æ—Ç–∫–∞ inline –∫–Ω–æ–ø–æ–∫
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ inline.py           # Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ middlewares/
‚îÇ       ‚îî‚îÄ‚îÄ error_handler.py    # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ connection.py           # –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π PostgreSQL (0.5.0+)
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ wb_parser.py            # –ü–∞—Ä—Å–∏–Ω–≥ –ø—É–±–ª–∏—á–Ω–æ–≥–æ API WB
‚îÇ   ‚îú‚îÄ‚îÄ media_downloader.py     # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–¥–∏–∞
‚îÇ   ‚îú‚îÄ‚îÄ hls_converter.py        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HLS ‚Üí MP4 (0.2.0+)
‚îÇ   ‚îú‚îÄ‚îÄ video_cache.py          # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ URLs (0.3.2+)
‚îÇ   ‚îú‚îÄ‚îÄ analytics.py            # –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (0.5.0+)
‚îÇ   ‚îú‚îÄ‚îÄ notifications.py        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª (0.5.0+)
‚îÇ   ‚îî‚îÄ‚îÄ digest.py               # –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç (0.5.0+)
‚îÇ
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ validators.py           # –í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ä—Ç–∏–∫—É–ª–æ–≤/—Å—Å—ã–ª–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ logger.py               # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py           # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ decorators.py           # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, retry)
‚îÇ
‚îú‚îÄ‚îÄ tests/                      # Unit-—Ç–µ—Å—Ç—ã (82% –ø–æ–∫—Ä—ã—Ç–∏–µ)
‚îÇ   ‚îú‚îÄ‚îÄ test_validators.py      # –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ test_wb_parser.py       # –¢–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞ WB
‚îÇ   ‚îú‚îÄ‚îÄ test_media_downloader.py # –¢–µ—Å—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–¥–∏–∞
‚îÇ   ‚îú‚îÄ‚îÄ test_handlers/          # –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ conftest.py             # Pytest —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îÇ
‚îî‚îÄ‚îÄ docs/                       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îî‚îÄ‚îÄ wb-api/                 # –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ WB API (18 —Ñ–∞–π–ª–æ–≤)
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ê—Ä—Ç–∏–∫—É–ª/—Å—Å—ã–ª–∫–∞
              ‚Üì
2. article.py ‚Üí ArticleValidator.extract_article()
              ‚Üì
3. WBParser ‚Üí –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞:
   ‚îú‚îÄ‚îÄ _find_basket() - –ø–æ–∏—Å–∫ basket (–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ vol ‚Üí basket)
   ‚îú‚îÄ‚îÄ _find_photos() - –ø–æ–∏—Å–∫ —Ñ–æ—Ç–æ 1-20
   ‚îî‚îÄ‚îÄ skip_video=True - –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–Ω–µ –∏—â–µ–º –≤–∏–¥–µ–æ —Å—Ä–∞–∑—É)
              ‚Üì
4. –ü–æ–∫–∞–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º "üé• –í–∏–¥–µ–æ: ‚è≥ –∏—â–µ–º 0%"
              ‚Üì
5. –§–æ–Ω–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤–∏–¥–µ–æ (asyncio.create_task):
   ‚îú‚îÄ‚îÄ VideoCache.get() - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ (TTL 1 —á–∞—Å)
   ‚îú‚îÄ‚îÄ _check_video() - –ø–æ–∏—Å–∫ –µ—Å–ª–∏ –Ω–µ—Ç –≤ –∫–µ—à–µ
   ‚îú‚îÄ‚îÄ progress_callback - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∫–∞–∂–¥—ã–µ 10%
   ‚îî‚îÄ‚îÄ VideoCache.set() - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
              ‚Üì
6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞: "üé• –í–∏–¥–µ–æ: –µ—Å—Ç—å ‚úÖ" –∏–ª–∏ "–Ω–µ—Ç"
              ‚Üì
7. callbacks.py ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ/–≤—Å—ë)
              ‚Üì
8. MediaDownloader ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
   ‚îú‚îÄ‚îÄ send_photos() - –≥—Ä—É–ø–ø–∞–º–∏ –ø–æ 10
   ‚îú‚îÄ‚îÄ send_video() - —Å HLS –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
   ‚îî‚îÄ‚îÄ send_both() - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### WBParser (services/wb_parser.py)

–ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Wildberries API. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä.

**–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –º–µ–¥–∏–∞:**

1. **Basket –ø–æ–∏—Å–∫** (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º):
   - –í—ã—á–∏—Å–ª—è–µ—Ç: `vol = nmId // 100000`, `part = nmId // 1000`
   - –ü–µ—Ä–µ–±–∏—Ä–∞–µ—Ç basket 1-100 –±–∞—Ç—á–∞–º–∏ –ø–æ 50
   - –ö–µ—à–∏—Ä—É–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ `vol ‚Üí basket` –≤ –ø–∞–º—è—Ç–∏
   - Timeout: 90 —Å–µ–∫—É–Ω–¥

2. **–§–æ—Ç–æ –ø–æ–∏—Å–∫**:
   - –ü–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –Ω–æ–º–µ—Ä–∞ 1-20 –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏—Ç 404
   - URL: `basket-{basket}.wbbasket.ru/vol{vol}/part{part}/{nmId}/images/big/{N}.webp`

3. **–í–∏–¥–µ–æ –ø–æ–∏—Å–∫** (–¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è):
   - **–ü–æ–ø—ã—Ç–∫–∞ 1**: Legacy MP4 —Ñ–æ—Ä–º–∞—Ç (`video.wildberries.ru/{nmId}/{nmId}.mp4`)
   - **–ü–æ–ø—ã—Ç–∫–∞ 2**: HLS —Ñ–æ—Ä–º–∞—Ç (–Ω–æ–≤—ã–π, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
   - HLS: –ü–µ—Ä–µ–±–æ—Ä 5000+ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π (basket 1-100 √ó vol 1-200)
   - Timeout: 30 —Å–µ–∫—É–Ω–¥, –±–∞—Ç—á–∏ –ø–æ 100 –∑–∞–ø—Ä–æ—Å–æ–≤

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π: limit=100, limit_per_host=50
- In-memory –∫–µ—à –¥–ª—è basket (_basket_cache: vol ‚Üí basket)
- In-memory –∫–µ—à –¥–ª—è –≤–∏–¥–µ–æ (VideoCache: nm_id ‚Üí video URL, TTL 1 —á–∞—Å)
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–µ–π —á–µ—Ä–µ–∑ asyncio.gather()
- –§–æ–Ω–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤–∏–¥–µ–æ —Å progress_callback –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (skip_video/skip_photos –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)

#### MediaDownloader (services/media_downloader.py)

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ–¥–∏–∞ –≤ Telegram —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.

- `send_photos()`: –ì—Ä—É–ø–ø–∞–º–∏ –ø–æ 10 (–ª–∏–º–∏—Ç Telegram API)
- `send_video()`: –û–¥–Ω–æ –≤–∏–¥–µ–æ —Å HLS –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- `send_both()`: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Ñ–æ—Ç–æ ‚Üí –≤–∏–¥–µ–æ
- Timeout: 120 —Å–µ–∫—É–Ω–¥ –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π

#### VideoCache (services/video_cache.py) ‚Äî –≤–µ—Ä—Å–∏—è 0.3.2+

–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ URLs –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ö–ª—é—á–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å TTL (Time To Live) 1 —á–∞—Å
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–∂–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (None) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ

**–ú–µ—Ç–æ–¥—ã:**
- `get(nm_id)` ‚Üí `(found: bool, url: Optional[str])` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –∫–µ—à–∞
- `set(nm_id, url)` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à
- `clear_expired()` - –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –∑–∞–ø–∏—Å–µ–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Å 10-30 —Å–µ–∫ –¥–æ ~1-2 —Å–µ–∫ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API Wildberries

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ò–µ—Ä–∞—Ä—Ö–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π:**
```python
WBBotException              # –ë–∞–∑–æ–≤–æ–µ
‚îú‚îÄ‚îÄ InvalidArticleError     # –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∞—Ä—Ç–∏–∫—É–ª–∞
‚îú‚îÄ‚îÄ ProductNotFoundError    # –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
‚îú‚îÄ‚îÄ NoMediaError            # –ù–µ—Ç —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ
‚îú‚îÄ‚îÄ WBAPIError              # –û—à–∏–±–∫–∞ API/—Å–µ—Ç–∏
‚îî‚îÄ‚îÄ HLSConversionError      # –û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ HLS (0.2.0+)
    ‚îî‚îÄ‚îÄ FFmpegNotFoundError # ffmpeg –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
```

**–£—Ä–æ–≤–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
1. Handler level - —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ catch
2. Middleware level - ErrorHandlerMiddleware (–≥–ª–æ–±–∞–ª—å–Ω—ã–π)
3. Decorator level - @retry_on_telegram_error

## –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–¥–∏–∞ Wildberries

–ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ CDN Wildberries (wbbasket.ru).

### –§–æ—Ä–º—É–ª—ã URL –º–µ–¥–∏–∞

**–§–æ—Ç–æ:**
```
https://basket-{basket}.wbbasket.ru/vol{vol}/part{part}/{nmId}/images/big/{N}.webp
```

–ì–¥–µ:
- `vol = nmId // 100000`
- `part = nmId // 1000`
- `N` = –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Ñ–æ—Ç–æ (1-20)
- `basket` = –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–µ—Ä–µ–±–æ—Ä–æ–º (0-99)

**–í–∏–¥–µ–æ (–¥–≤–∞ —Ñ–æ—Ä–º–∞—Ç–∞):**

1. **Legacy MP4** (—Å—Ç–∞—Ä—ã–µ —Ç–æ–≤–∞—Ä—ã):
```
https://video.wildberries.ru/{nmId}/{nmId}.mp4
```

2. **HLS —Ñ–æ—Ä–º–∞—Ç** (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã):
```
https://videonme-basket-{basket}.wbbasket.ru/vol{vol}/part{part}/{nmId}/hls/1440p/index.m3u8
```

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: 82%**

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements-dev.txt

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest tests/ -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/ --cov=. --cov-report=term-missing

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
pytest tests/test_wb_parser.py -v
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

| –§–∞–π–ª | –¢–µ—Å—Ç–æ–≤ | –ü–æ–∫—Ä—ã–≤–∞–µ—Ç |
|------|--------|-----------|
| test_validators.py | 8 | –í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ä—Ç–∏–∫—É–ª–æ–≤/—Å—Å—ã–ª–æ–∫ |
| test_wb_parser.py | 8+ | –ü–æ–∏—Å–∫ –º–µ–¥–∏–∞ WB |
| test_media_downloader.py | 10+ | –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–¥–∏–∞ |
| test_handlers/ | 14+ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–æ—Ç–∞ |
| test_decorators.py | 9+ | –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã |

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- `pytest` - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `pytest-asyncio` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ async —Ç–µ—Å—Ç–æ–≤
- `pytest-cov` - –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
- `aioresponses` - –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `bot.log` –∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å.

**–§–æ—Ä–º–∞—Ç—ã:**
- **–§–∞–π–ª:** –î–µ—Ç–∞–ª—å–Ω—ã–π —Å –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞, —Å—Ç—Ä–æ–∫–æ–π, —Ñ—É–Ω–∫—Ü–∏–µ–π
- **–ö–æ–Ω—Å–æ–ª—å:** –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

**–ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤:**
```
# –£—Å–ø–µ—à–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
2026-01-19 15:00:00 - wb_parser - INFO - üîç –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –º–µ–¥–∏–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ 12345678
2026-01-19 15:00:02 - wb_parser - INFO - ‚úÖ –ù–∞–π–¥–µ–Ω–æ 5 —Ñ–æ—Ç–æ –∏ 1 –≤–∏–¥–µ–æ
2026-01-19 15:00:05 - media_downloader - INFO - ‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 5 —Ñ–æ—Ç–æ –≤ —á–∞—Ç 123456

# –û—à–∏–±–∫–∞
2026-01-19 15:00:10 - wb_parser - ERROR - ‚ùå –¢–æ–≤–∞—Ä 99999999 –Ω–µ –Ω–∞–π–¥–µ–Ω
```

**Rotation:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 MB
- Backup —Ñ–∞–π–ª–æ–≤: 5 —à—Ç—É–∫

### Debug —Ä–µ–∂–∏–º

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
LOG_LEVEL=DEBUG
DEBUG_HTTP_REQUESTS=True    # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã
DEBUG_MEASURE_TIME=True     # –ò–∑–º–µ—Ä—è—Ç—å –≤—Ä–µ–º—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
```

## Troubleshooting

### –û—à–∏–±–∫–∞: "Failed to load settings"

**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∞–π–ª `.env` –∏–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω `BOT_TOKEN`.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ –¥–æ–±–∞–≤—å—Ç–µ BOT_TOKEN
```

### –û—à–∏–±–∫–∞: "WB API error"

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- Wildberries –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–µ–≤—ã—à–µ–Ω rate limit

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
2. –£–≤–µ–ª–∏—á—å—Ç–µ `WB_API_TIMEOUT` –≤ `.env` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10s)
3. –£–≤–µ–ª–∏—á—å—Ç–µ `WB_RATE_LIMIT_DELAY` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.2s)
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ

### –û—à–∏–±–∫–∞: "Timeout connecting to Wildberries"

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–ª–∏ –¥–æ–ª–≥–∏–π –ø–æ–∏—Å–∫ basket.

**–†–µ—à–µ–Ω–∏–µ:**
```env
WB_API_TIMEOUT=30        # –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 30 —Å–µ–∫—É–Ω–¥
MAX_RETRIES=5            # –ë–æ–ª—å—à–µ –ø–æ–≤—Ç–æ—Ä–æ–≤
```

### –û—à–∏–±–∫–∞: "Product not found"

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–≤–µ—Ä–Ω—ã–π –∞—Ä—Ç–∏–∫—É–ª
- –¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω —Å WB
- Basket –Ω–µ –Ω–∞–π–¥–µ–Ω (–æ—á–µ–Ω—å —Ä–µ–¥–∫–æ)

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞—Ä—Ç–∏–∫—É–ª –Ω–∞ —Å–∞–π—Ç–µ WB
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ç–æ–≤–∞—Ä
- –í–∫–ª—é—á–∏—Ç–µ `LOG_LEVEL=DEBUG` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –í–∏–¥–µ–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –í–∏–¥–µ–æ –±–æ–ª—å—à–µ 20 MB (–ª–∏–º–∏—Ç Telegram –¥–ª—è URL upload).

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram API, –æ–±–æ–π—Ç–∏ –Ω–µ–ª—å–∑—è.

### –ü–æ–∏—Å–∫ –∑–∞–Ω–∏–º–∞–µ—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–∏—Å–∫ basket –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –¥–æ 90 —Å–µ–∫—É–Ω–¥ –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤.

**–î–µ—Ç–∞–ª–∏:**
- Basket –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–±–æ—Ä–æ–º (0-99)
- –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Ç–æ–≥–æ –∂–µ —Ç–æ–≤–∞—Ä–∞ –±—É–¥–µ—Ç –±—ã—Å—Ç—Ä–µ–µ

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
tail -f bot.log

# –ò–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ DEBUG
LOG_LEVEL=DEBUG python main.py
```

## –õ–∏–º–∏—Ç—ã

### Telegram Bot API (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π):
- –§–æ—Ç–æ: –¥–æ 5 MB (URL), 10 MB (multipart)
- –í–∏–¥–µ–æ: –¥–æ 20 MB (URL), 50 MB (multipart)
- sendMediaGroup: 2-10 —Ñ–∞–π–ª–æ–≤ –∑–∞ —Ä–∞–∑

### Local Bot API (0.4.0+):
- **–í–∏–¥–µ–æ: –¥–æ 2 GB** (–ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Local Bot API Server)
- –§–æ—Ç–æ: —Ç–µ –∂–µ –ª–∏–º–∏—Ç—ã
- –¢—Ä–µ–±—É–µ—Ç –¥–µ–ø–ª–æ—è –Ω–∞ VPS —Å Docker

### Wildberries API:
- Rate limit –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 10-20 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏: –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π handler –≤ `bot/handlers/`
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ router –≤ `main.py`
3. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã –≤ `tests/`
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç: `pytest tests/ -v`

### –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∞

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
- ‚úÖ PEP 8 compliance
- ‚úÖ Type hints –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ Docstrings –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ Async/await –¥–ª—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∏–∑ `utils/decorators.py`:
  - `@log_execution_time()` - –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  - `@log_function_call()` - –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã
  - `@retry_on_telegram_error()` - –∞–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –°–æ–∑–¥–∞–≤–∞—Ç—å —Ç–µ—Å—Ç—ã —Å `pytest-asyncio`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `aioresponses` –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è HTTP

### –ü—Ä–∏–º–µ—Ä –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤

```python
from utils.decorators import log_execution_time, retry_on_telegram_error

@log_execution_time()
@retry_on_telegram_error(max_retries=3)
async def my_handler(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø–æ–≤—Ç–æ—Ä–∞–º–∏"""
    pass
```

### –ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏
pytest tests/ -v

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ
pytest tests/ --cov=. --cov-report=term-missing

# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–µ —É–ø–∞–ª–æ –Ω–∏–∂–µ 80%
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ (–≤–µ—Ä—Å–∏—è 0.3.2):**
- –ü–æ–∫–∞–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞: 2-6 —Å–µ–∫—É–Ω–¥ (—Ç–æ–ª—å–∫–æ —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ –≤ —Ñ–æ–Ω–µ)
- –ü–æ–∏—Å–∫ basket: 1-2 —Å–µ–∫—É–Ω–¥—ã (—Å –∫–µ—à–µ–º ~–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
- –ü–æ–∏—Å–∫ —Ñ–æ—Ç–æ: 1-3 —Å–µ–∫—É–Ω–¥—ã
- –ü–æ–∏—Å–∫ –≤–∏–¥–µ–æ (—Ñ–æ–Ω–æ–≤—ã–π): 5-30 —Å–µ–∫—É–Ω–¥ (MP4 + HLS –ø–µ—Ä–µ–±–æ—Ä)
- –ü–æ–∏—Å–∫ –≤–∏–¥–µ–æ (–∏–∑ –∫–µ—à–∞): 1-2 —Å–µ–∫—É–Ω–¥—ã (—Ç–æ–ª—å–∫–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –µ—Å–ª–∏ HLS)
- –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–¥–∏–∞: 2-10 —Å–µ–∫—É–Ω–¥

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–µ–π HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- In-memory –∫–µ—à –¥–ª—è basket (vol ‚Üí basket, –±–µ—Å—Å—Ä–æ—á–Ω—ã–π)
- In-memory –∫–µ—à –¥–ª—è –≤–∏–¥–µ–æ (nm_id ‚Üí video URL, TTL 1 —á–∞—Å)
- –§–æ–Ω–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤–∏–¥–µ–æ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI)
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞ (skip_video/skip_photos)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (100 max, 50 per host)
- Timeout –∏ retry –º–µ—Ö–∞–Ω–∏–∑–º—ã

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞ (–≤–µ—Ä—Å–∏—è 0.5.0):**
- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥: ~1950 —Å—Ç—Ä–æ–∫
- –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥: ~2350 —Å—Ç—Ä–æ–∫
- –ü–æ–∫—Ä—ã—Ç–∏–µ: 82%
- –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 113
- Python —Ñ–∞–π–ª–æ–≤: 35

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `docs/`:

- **[VDS.md](docs/VDS.md)** - –î–µ–ø–ª–æ–π –Ω–∞ VPS (Timeweb Cloud + Docker)
- **[PLAN.md](docs/PLAN.md)** - –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π
- [WB API –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫](docs/wb-api/README.md) - –ú–µ—Ç–æ–¥—ã API Wildberries
- [–ü—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](docs/wb-api/PROMPTS.md) - Ready-to-use –ø—Ä–æ–º–ø—Ç—ã
- [CLAUDE.md](CLAUDE.md) - –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

- GitHub: [–≤–∞—à GitHub]
- Telegram: [@–≤–∞—à_username]

## –î–∏—Å–∫–ª–µ–π–º–µ—Ä

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–µ API Wildberries. –ê–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è API –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–æ—Å—Ç—É–ø–∞.
